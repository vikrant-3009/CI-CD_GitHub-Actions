name: Selenium Workflow

on: workflow_dispatch

jobs:
    selenium:
        name: Selenium Test
        runs-on: centos-2
        # permissions:
        #     pages: write
        #     id-token: write
        steps:
            - name: Checkout
              uses: actions/checkout@v3
            
            - name: Run Test
              id: run-test
              run: |
                export JAVA_HOME=/opt/jdk-17.0.2/
                export M2_HOME=/opt/apache-maven-3.9.6/
                export PATH=$PATH:$M2_HOME/bin
                mvn -f selenium-testing/pom.xml test -Dmaven.test.failure.ignore=true \
                -Dhostname=192.168.56.104 -Dport=9010 -Dcontext=/mvcapp/calculate
            
            - name: Move Report to a new directory
              if: steps.run-test.outcome == 'success'
              run: |
                mkdir -p selenium-testing/target/deploy-reports
                cp selenium-testing/target/surefire-reports/emailable-report.html selenium-testing/target/deploy-reports/
      
            - name: Upload Selenium Test Report
              uses: actions/upload-artifact@v3
              with:
                name: Selenium Test Report
                path: selenium-testing/target/surefire-reports/emailable-report.html
            
            # - name: Upload pages artifact
            #   uses: actions/upload-pages-artifact@v3
            #   with:
            #     path: selenium-testing/target/surefire-reports/emailable-report.html

            # - name: Deploy to GitHub Pages
            #   id: deployment
            #   uses: actions/deploy-pages@v2
            #   with:
            #     artifact_name: "Selenium Test Report"

            - name: Deploy Report
              uses: JamesIves/github-pages-deploy-action@v4
              with:
                branch: 'selenium-report'
                folder: selenium-testing/target/deploy-reports